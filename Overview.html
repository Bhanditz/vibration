<!DOCTYPE html>
<html>
  <head>
    <title>Vibration API</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <script src='../ReSpec.js/js/respec.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "FPWD",
          shortName:            "vibration",
          publishDate:  "2011-11-17",
          // previousPublishDate:  "2011-10-21",
          // previousMaturity:     "ED",
          edDraftURI:           "http://dev.w3.org/2009/dap/vibration/",
          // lcEnd: "2009-08-05",
          editors:  [
              { name: "Anssi Kostiainen", company: "Nokia" }
          ],
          inlineCSS:    true,
          noIDLIn:      true,
          extraCSS:     ["../ReSpec.js/css/respec.css"],
          wg:           "Device APIs Working Group",
          wgURI:        "http://www.w3.org/2009/dap/",
          wgPublicList: "public-device-apis",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/43696/status",
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      This specification defines an API that provides access to the vibration
      mechanism of the hosting device. Vibration is a form of tactile feedback.
    </section>
    
    <section id='sotd'>
      <p>
        This document represents the early consensus of the group on the scope and features of the
        Vibration API. It should be noted that the group is aware of more advanced use cases that cannot
        be realised using this simpler first version. The intent is to address them in a future revision.
      </p>
    </section>
    
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The Vibration API defines a means for web developers to
        programmatically provide tactile feedback in the form of vibration. The
        API is designed to tackle high-value use cases related to gaming, and
        is not meant to be used as a generic notification mechanism.
      </p>
    </section>
    
    <section id='conformance'>
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn id="ua">user agent</dfn> that implements the
        interfaces that it contains.
      </p>
    </section>
    
    <section>
      <h2>Vibration Interface</h2>
      <div class='idl' title='Navigator implements Vibration'></div>
      <dl title='interface Vibration' class='idl'>
        <dt>void vibrate()</dt>
        <dd>
          <dl class='parameters'>
            <dt>optional unsigned long time</dt>
            <dd>
              Vibration time in milliseconds.
            </dd>
          </dl>
          <dl class='exception' title='NotSupportedError'>
            <dt>
              NOT_SUPPORTED_ERR&nbsp;(9)
            </dt>
            <dd>
              The <code>time</code> argument exceeds an implementation
              dependent limit.
            </dd>
          </dl>
          <dt>void vibrate()</dt>
          <dd>
            <dl class='parameters'>
              <dt>optional unsigned long[] pattern</dt>
              <dd>
                A vibration pattern represented by a list of time entries.
                Odd entries represent vibration time in milliseconds, even
                entries still periods in milliseconds between the vibrations.
              </dd>
            </dl>
            <dl class='exception' title='NotSupportedError'>
              <dt>
                NOT_SUPPORTED_ERR&nbsp;(9)
              </dt>
              <dd>
                The length of the <code>pattern</code> argument exceeds an
                implementation-dependent limit, or one or more entries in the
                <code>pattern</code> argument exceed an implementation
                dependent limit.
              </dd>
            </dl>
          </dd>
      </dl>
      
      <p>
        The <code>vibrate()</code> method, when invoked, MUST run the algorithm
        for <a>processing vibration patterns</a>.
      </p>
      <p>
        The rules for <dfn>processing vibration patterns</dfn> are as given in
        the following algorithm:
      </p>
      <ol>
        <!--li>
          If the <var>already started</var> flag is set to true, the
          <a class="product-ua" href="#ua">user agent</a> MUST cancel the
          pre-existing instance of the <a>processing vibration patterns</a>
          algorithm, if any.
        </li-->
        <li>
          If the <code>
          <a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#pv-hidden">
          hidden</a></code> attribute [[!PAGE-VISIBILITY]] is set to true,
          abort these steps.
        </li>
        <!--li>
          Let <var>already started</var> flag be true.
        </li-->
        <li>
          Let <var>pattern</var> be the value of the first argument.
        </li>
        <li>
          If <var>pattern</var> is 0, an empty list, or <code>null</code>, cancel the pre-existing
          instance of the <a>processing vibration patterns</a> algorithm, if
          any, and abort these steps.
        </li>
        <li>
          If <var>pattern</var> is a list, proceed to the next step.
          Otherwise run the following substeps:
          <ol>
            <li>
              Let <var>list</var> be an initially empty list, and add
              <var>pattern</var> to <var>list</var>.
            </li>
            <li>
              Let <var>pattern</var> be <var>list</var>.
            </li>
          </ol>
        </li>
        <li>
          If any entry of <var>pattern</var> exceeds an
          implementation-dependent limit, then the
          <a class="product-ua" href="#ua">user agent</a> MAY throw a
          <code>NotSupportedError</code> exception and abort these steps.
        </li>
        <li>
          If the length of <var>pattern</var> is even, then remove the last
          entry in <var>pattern</var>.
        </li>
        <li>
          If the length of <var>pattern</var> exceeds an implementation
          dependent limit, the <a class="product-ua" href="#ua">user agent</a>
          MAY throw a <code>NotSupportedError</code> exception [[!DOM4]] and
          abort these steps.
        </li>
        <li>
          Cancel the pre-existing instance of the <a>processing vibration
          patterns</a> algorithm, if any.
        </li>
        <li>
          An implementation MAY abort the algorithm at this point.
          <div class="note">
            For example, an implementation might abort the
            algorithm because the user has set a preference indicating that
            pages at a given origin should never be able to vibrate the device,
            or an implementation might cap the total amount of time a page may
            cause the device to vibrate and reject requests in excess of this
            limit.
          </div>
        </li>
        <li>
          For each <var>time</var> in <var>pattern</var>, run the following
          substeps:
          <ol>
            <li>
              If the index of <var>time</var> is even (the earliest even entry
              has index 0), vibrate the device for <var>time</var>
              milliseconds.
            </li>
            <li>
              Otherwise
              <a href="http://dev.w3.org/html5/spec/webappapis.html#pause">
              pause</a> [[!HTML5]] for <var>time</var> milliseconds.
            </li>
          </ol>
        </li>
      </ol>
      <p>
        When the
        <code><a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#sec-visibilitychange-event">
        visibilitychange</a></code> event [[!PAGE-VISIBILITY]] is dispatched at
        the <code>Document</code>, the <a class="product-ua" href="#ua">user
        agent</a> MUST run the following steps:
      </p>
      <ol>
        <li>
          If the <code><a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#pv-hidden">
          hidden</a></code> attribute [[!PAGE-VISIBILITY]] is set to true,
          the <a class="product-ua" href="#ua">user agent</a> MUST suppress
          the vibration produced by running the pre-existing instance of the
          <a>processing vibration patterns</a> algorithm, if any.
        </li>
        <li>
          If the <code><a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/PageVisibility/Overview.html#pv-hidden">
          hidden</a></code> attribute [[!PAGE-VISIBILITY]] is set to false,
          the <a class="product-ua" href="#ua">user agent</a> MUST restore
          the vibration produced by running the pre-existing instance of the <a>processing vibration
          patterns</a> algorithm, if any.
        </li>
      </ol>
      <p>
        If the device does not provide a vibration mechanism, or it is
        disabled, the <a class="product-ua" href="#ua">user agent</a> MUST
        silently ignore any invocations of the <code>vibrate()</code> method.
      </p>
    </section>

    <section class='informative'>
      <h2>Examples</h2>
      <p>
        This specification is inspired by Mozilla's
        <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=679966">
        Web Vibrator prototype</a>. Below is an excerpt extracted from
        the
        <a href="https://bugzilla.mozilla.org/attachment.cgi?id=571161&amp;action=diff#a/dom/interfaces/base/nsIDOMNavigator.idl_sec2">
        source code</a> to be more readily available:
      </p>
      <div class='example'>
        <pre class='example sh_javascript'>
        /**
         * Pulse the device's vibrator, if it has one.  If the device does not have a
         * vibrator, this function does nothing.
         *
         * mozVibrate takes one optional argument.  The argument specifies how long
         * to vibrate for, or it gives a pattern of vibrator-on/vibrator-off timings.
         *
         * If a vibration pattern is in effect when this function is called, this
         * call will overwrite the existing pattern, if this call successfully
         * completes.
         *
         * We handle the argument to mozVibrate as follows.
         *
         * - If the argument is undefined, null, 0, or the empty list, we cancel any
         *   outstanding vibration pattern; that is, we stop the device from vibrating.
         *
         * - Otherwise, if the argument X is not a list, we treat it as though it's
         *   the singleton list [X] and then proceed as below.
         *
         * - If the argument is a list (or if we wrapped it as a list above), then we
         *   try to convert each element in the list to an integer, by first
         *   converting it to a number and then rounding.  If we cannot convert any
         *   element to an integer, or if any of the integers are negative, we throw
         *   an illegal value exception.
         *
         *   This list of integers specifies a vibration pattern.  Given a list of
         *   numbers
         *
         *      [a_1, b_1, a_2, b_2, ..., a_n]
         *
         *   the device will vibrate for a_1 milliseconds, then be still for b_1
         *   milliseconds, then vibrate for a_2 milliseconds, and so on.
         *
         *   The list may contain an even or an odd number of elements, but if you
         *   pass an even number of elements (that is, if your list ends with b_n
         *   instead of a_n), the final element doesn't specify anything meaningful.
         *
         *   We may throw an illegal value exception if the vibration pattern is too
         *   long, or if any of its elements is too large.
         *
         */
         [implicit_jscontext]
         void mozVibrate([optional] in jsval aPattern);
        </pre>
      </div>
      
      <p>
        In the following example the device vibrates for 1 second:
      <div class='example'>
        <pre class='example sh_javascript'>
          // vibrate for 1 second
          navigator.vibrate(1000);
          
          // or alternatively
          navigator.vibrate([1000]);
        </pre>
      </div>
      <p>
        In the following example the device vibrates for 1 second, is still for
        0.5 seconds, and vibrates again for 2 seconds:
      </p>
      <div class='example'>
        <pre class='example sh_javascript'>
          navigator.vibrate([1000, 500, 2000]);
        </pre>
      </div>
      <p>
        <p>
          The following example cancels any existing vibrations:
        </p>
        <div class='example'>
          <pre class='example sh_javascript'>
            navigator.vibrate(0);
            
            // or alternatively
            navigator.vibrate([]);
          </pre>
        </div>
    </section>
    <section class='appendix'>
      <h2>Acknowledgements</h2>
      <p>
        Thanks to the Mozilla WebAPI team for providing the WebVibrator
        prototype as an initial input.
      </p>
    </section>
  </body>
</html>
